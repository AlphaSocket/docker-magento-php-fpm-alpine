#!/bin/sh
#

# exit if a command fails
set -e

source /usr/local/envvars

# Install dependencies
apk --no-cache add binutils-libs binutils m4 perl autoconf libmagic file libgcc libstdc++ gmp libgomp libatomic mpfr3 gcc libc-dev g++ make re2c

# Install PHP extension gd
if [ True = True ]; then
    apk --no-cache add freetype libpng libjpeg-turbo freetype-dev libpng-dev libjpeg-turbo-dev musl musl-dev
    docker-php-ext-configure gd --with-gd --with-freetype-dir=/usr/include/ --with-png-dir=/usr/include/ --with-jpeg-dir=/usr/include/
    docker-php-ext-install gd
fi

# Install PHP extension iconv
if [ True = True ]; then
    apk --no-cache add musl musl-dev
    docker-php-ext-install iconv
fi

# Install PHP extension opcache
if [ True = True ]; then
    apk --no-cache add musl musl-dev
    docker-php-ext-install opcache
fi

# Install PHP extension readline
if [ True = True ]; then
    apk --no-cache add musl-dev libedit-dev
    docker-php-ext-install readline
fi

# Install PHP extension soap
if [ True = True ]; then
    apk --no-cache add libxml2-dev
    docker-php-ext-install soap
fi

# Install PHP extension xml
if [ True = True ]; then
    apk --no-cache add libxml2-dev
    docker-php-ext-install xml
fi

# Install PHP extension mysqli
if [ True = True ]; then
    apk --no-cache add libxml2-dev
    docker-php-ext-install mysqli
fi

# Install PHP extension curl
if [ True = True ]; then
    apk --no-cache add curl-dev
    docker-php-ext-install curl
fi

# Install PHP extension json
if [ $SETUP_PHP_EXT_JSON = True ]; then
    docker-php-ext-install json
fi

# Install PHP extension mcrypt
if [ False = True ]; then
    apk --no-cache add libmcrypt-dev libltdl
    docker-php-ext-install mcrypt
fi

# Install PHP extension mbstring
if [ True = True ]; then
    docker-php-ext-install mbstring
fi

# Install PHP extension sodium
if [ True = True ]; then
    apk --no-cache add libsodium-dev
    docker-php-ext-install sodium
fi

# Install PHP extension zip
if [ True = True ]; then
    apk --no-cache add zlib
    docker-php-ext-install zip
fi

# Install PHP extension redis
if [ True = True ]; then
    pecl install redis
fi

# Install PHP extension xdebug
if [ True = True ]; then
    pecl install xdebug
fi

# Clean container
apk del m4 perl autoconf libmagic file libgcc libstdc++ gmp libgomp libatomic mpfr3 gcc libc-dev g++ make re2c



exit 0